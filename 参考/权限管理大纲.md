# CST 权限管理


##### 前端

1. 首页导航栏
    页面加载时根据token中的用户名向后端请求权限等级，
    根据权限等级加载相应的导航栏

2. 超级管理员赋权页面
    有4个角色（数据库管理人员，外包运维人员，业务系统供原厂维护人员，普通用户）可以赋权给人员。

##### 数据库
 5表1图

#创建角色表
create table roles (
	rid serial primary key,     //角色编号
	rname varchar(20) unique not null    //角色名
)

#创建功能表
create table func(
	fid serial primary key,        //功能编号
	fname varchar(20) unique not null,    //功能名
	api varchar(30) unique not null       //功能接口
)

#创建用户表
create table users(
	uid serial primary key,       //用户编号
	uname varchar(20) unique not null   //用户名
)

#创建角色-功能表
create table roles_func(
	rfid serial primary key,             //ID
	rid integer references roles(rid),   //角色编号
	fid integer references func(fid)      //功能编号
)

#创建用户-角色表
create table users_roles(
	urid serial primary key,         //ID
	uid integer references users(uid), //用户编号
	rid integer references roles(rid),  //角色编号
)

#创建用户-角色-功能视图
create view urfview(uname,rname,fname) as select uname,rname,fname from users,roles,func,users_roles,roles_func where users.uid=users_roles.uid and roles.rid=roles_func.rid

####后端
1. 权限查询函数 SelectPermis()
    根据token传过来的用户名，在数据库中查找权限等级，将权限等级返回给前端

2. 权限判断函数 IsPermitted()
    1. 这个函数用来判断当前用户是否拥有操作当前功能的权限。
    2. 所有请求发送到后端时候，后端的function开头都应该加上这个函数。
    3. 函数返回true和false，true表示权限成功，function继续运行，否则跳出函数，不再执行后续操作。

    实现：
    1. 函数有两个参数:用户名(id),地址(api);
    2. 根据用户名在ur表中查询当前用户的角色(roles);
    3. 根据查询到的角色(roles)在roles_func表中查询该角色(roles)拥有的功能的id(fid),
    4. 使用功能的id(fid)到功能表(func)中查询到相应的api。
    5. 判断该api与参数api是否相同，相同返回true，否则返回false；

3. 修改权限函数  UpdatePermis()
   通过此函数修改用户权限